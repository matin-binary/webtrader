define(["exports","jquery","websockets/binary_websockets","navigation/menu","charts/chartWindow","../common/marketUtils","jquery-growl","common/util"],function(t,e,a,n,r,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getSpecificMarketData=t.isMarketDataPresent=t.getMarketData=t.init=void 0;var u=l(e),s=l(a),m=l(n),o=l(r);function l(t){return t&&t.__esModule?t:{default:t}}function c(){s.default.send({active_symbols:"brief"}).then(function(t){var r=[];local_storage.set("active_symbols",t.active_symbols);var e=_(t.active_symbols).groupBy("market").map(function(t){var e=t,a=_.head(e),n={name:a.market,display_name:a.market_display_name};return n.submarkets=_(e).groupBy("submarket").map(function(t){var e=_.head(t),a={name:e.submarket,display_name:e.submarket_display_name};return a.instruments=_.map(t,function(t){return r.push(t.symbol),{symbol:t.symbol,display_name:t.display_name}}),a}).value(),n}).value();k=y.map(function(t){return{display_name:t.display_name,name:t.name,submarkets:t.submarkets.map(function(t){return{display_name:t.display_name,instruments:t.instruments.filter(function(t){return-1!==r.indexOf(t.symbol)})}}).filter(function(t){return 0!==t.instruments.length})}}).filter(function(t){return 0!==t.submarkets.length}),k=(0,i.getSortedMarketSubmarkets)(e);var a=(0,u.default)("#nav-menu").find(".instruments");a.find("> ul").remove(),m.default.refreshMenu(a,k,f)})}function d(){local_storage.get("oauth")?s.default.cached.authorize().then(function(){var t=local_storage.get("authorize").country;s.default.cached.send({landing_company:t}).then(function(t){t.landing_company;c()})}):c()}function f(t,e){o.default.addNewWindow({instrumentCode:t,instrumentName:e,timePeriod:"1d",type:"candlestick"})}var k=[],y=[],p=t.init=function(){return s.default.cached.send({trading_times:(new Date).toISOString().slice(0,10)}).then(function(t){return y=m.default.extractChartableMarkets(t),d(),s.default.events.on("login",d),s.default.events.on("logout",d),y})},b=t.getMarketData=function(){return k},g=t.isMarketDataPresent=function(a,t){var n=!1;t=t||k;var r=this;return u.default.each(t,function(t,e){return e.submarkets||e.instruments?n=r.isMarketDataPresent(a,e.submarkets||e.instruments):u.default.trim(e.display_name)==u.default.trim(a)&&(n=!0),!n}),n},v=t.getSpecificMarketData=function(a,t){var n={};t=t||k;var r=this;return u.default.each(t,function(t,e){return e.submarkets||e.instruments?n=r.getSpecificMarketData(a,e.submarkets||e.instruments):u.default.trim(e.display_name)==u.default.trim(a)&&(n=e),u.default.isEmptyObject(n)}),n};t.default={init:p,getMarketData:b,isMarketDataPresent:g,getSpecificMarketData:v}});